<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Echo Dungeon</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background-color: #000;
            color: #fff;
            font-family: Arial, sans-serif;
            text-align: center;
        }
        
        #startButton {
            width: 300px;
            height: 100px;
            background-color: #ff4444;
            color: white;
            border: none;
            font-size: 24px;
            cursor: pointer;
            border-radius: 10px;
            margin: 50px auto;
            display: block;
        }
        
        #gameText {
            background-color: #222;
            padding: 20px;
            margin: 20px auto;
            border-radius: 10px;
            max-width: 600px;
            min-height: 200px;
        }
    </style>
</head>
<body>
    <h1>Echo Dungeon</h1>
    
    <button id="startButton" onclick="startGame()">
        CLICK TO START VOICE GAME
    </button>
    
    <div id="gameText">
        <p>Click the red button above to begin your voice-controlled adventure!</p>
        <p>Make sure to allow microphone access when prompted.</p>
    </div>

    <script>
        let synth = window.speechSynthesis;
        let recognition = null;
        let gameStarted = false;
        let isListening = false;
        
        let player = {
            health: 100,
            class: null,
            location: 'entrance',
            inventory: []
        };
        
        let rooms = {
            entrance: {
                description: "You stand at the entrance of a dark dungeon. You can go north or east.",
                exits: { north: 'corridor', east: 'chamber' },
                items: ['torch'],
                monsters: []
            },
            corridor: {
                description: "A stone corridor. You can go south to entrance or north to treasury.",
                exits: { south: 'entrance', north: 'treasury' },
                items: ['health potion'],
                monsters: ['goblin']
            },
            chamber: {
                description: "A round chamber. You can go west to entrance or north to boss room.",
                exits: { west: 'entrance', north: 'boss_room' },
                items: ['sword'],
                monsters: ['skeleton']
            },
            treasury: {
                description: "A treasure room full of gold. You can go south to corridor.",
                exits: { south: 'corridor' },
                items: ['treasure'],
                monsters: ['guardian']
            },
            boss_room: {
                description: "The final room with a throne. You can go south to chamber.",
                exits: { south: 'chamber' },
                items: ['crown'],
                monsters: ['boss']
            }
        };
        
        let currentRoom = 'entrance';

        function speak(text) {
            console.log('Speaking:', text);
            document.getElementById('gameText').innerHTML += '<p>' + text + '</p>';
            
            if (synth) {
                synth.cancel();
                let utterance = new SpeechSynthesisUtterance(text);
                utterance.rate = 1.2; // Faster speech
                utterance.pitch = 1.0;
                utterance.volume = 1.0;
                synth.speak(utterance);
            }
        }

        function startGame() {
            document.getElementById('startButton').style.display = 'none';
            
            if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
                speak("Sorry, voice recognition is not supported. Please use Chrome or Edge browser.");
                return;
            }

            let SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            recognition = new SpeechRecognition();
            
            recognition.continuous = false;
            recognition.interimResults = false;
            recognition.lang = 'en-US';

            recognition.onstart = function() {
                isListening = true;
                console.log('Listening started');
            };

            recognition.onresult = function(event) {
                let command = event.results[0][0].transcript.toLowerCase();
                console.log('Command heard:', command);
                processCommand(command);
            };

            recognition.onerror = function(event) {
                console.log('Speech error:', event.error);
                isListening = false;
                if (event.error === 'not-allowed') {
                    speak("Please allow microphone access and try again.");
                } else {
                    speak("I didn't hear you clearly. Let me listen again.");
                    setTimeout(startListening, 1000);
                }
            };

            recognition.onend = function() {
                isListening = false;
                setTimeout(startListening, 2000);
            };

            speak("Welcome to Echo Dungeon! Choose your class by saying: warrior, mage, or rogue.");
            setTimeout(startListening, 3000);
        }

        function startListening() {
            if (recognition && !isListening) {
                try {
                    recognition.start();
                } catch (e) {
                    console.log('Recognition start error:', e);
                }
            }
        }

        function processCommand(command) {
            if (!gameStarted) {
                if (command.includes('warrior')) {
                    player.class = 'warrior';
                    gameStarted = true;
                    speak("You are now a warrior! Your adventure begins.");
                    describeLocation();
                } else if (command.includes('mage') || command.includes('wizard')) {
                    player.class = 'mage';
                    gameStarted = true;
                    speak("You are now a mage! Your adventure begins.");
                    describeLocation();
                } else if (command.includes('rogue') || command.includes('thief')) {
                    player.class = 'rogue';
                    gameStarted = true;
                    speak("You are now a rogue! Your adventure begins.");
                    describeLocation();
                } else {
                    speak("Please say warrior, mage, or rogue to choose your class.");
                }
                return;
            }

            // Movement
            if (command.includes('north') || command.includes('go north')) {
                movePlayer('north');
            } else if (command.includes('south') || command.includes('go south')) {
                movePlayer('south');
            } else if (command.includes('east') || command.includes('go east')) {
                movePlayer('east');
            } else if (command.includes('west') || command.includes('go west')) {
                movePlayer('west');
            }
            // Combat
            else if (command.includes('attack') || command.includes('fight')) {
                fight();
            }
            // Search
            else if (command.includes('search') || command.includes('look')) {
                search();
            }
            // Inventory
            else if (command.includes('inventory') || command.includes('items')) {
                showInventory();
            }
            // Use items
            else if (command.includes('use potion') || command.includes('drink potion')) {
                usePotion();
            }
            // Status
            else if (command.includes('status') || command.includes('health')) {
                speak(`Your health is ${player.health}. You are a ${player.class}.`);
            }
            // Location
            else if (command.includes('where') || command.includes('location')) {
                describeLocation();
            }
            // Help
            else if (command.includes('help')) {
                speak("Say: north, south, east, west to move. Say attack to fight. Say search to look for items. Say inventory to check items. Say status for health.");
            }
            else {
                speak("I don't understand. Say help for commands.");
            }
        }

        function movePlayer(direction) {
            let room = rooms[currentRoom];
            if (room.exits[direction]) {
                currentRoom = room.exits[direction];
                player.location = currentRoom;
                speak(`You go ${direction}.`);
                setTimeout(describeLocation, 1000);
            } else {
                speak(`You cannot go ${direction} from here.`);
            }
        }

        function describeLocation() {
            let room = rooms[currentRoom];
            let description = room.description;
            
            if (room.monsters.length > 0) {
                description += ` A ${room.monsters[0]} is here!`;
            }
            
            if (room.items.length > 0) {
                description += ` You see: ${room.items.join(', ')}.`;
            }
            
            speak(description);
        }

        function fight() {
            let room = rooms[currentRoom];
            if (room.monsters.length === 0) {
                speak("Nothing to fight here.");
                return;
            }
            
            let monster = room.monsters[0];
            let playerRoll = Math.floor(Math.random() * 20) + 1;
            let monsterRoll = Math.floor(Math.random() * 20) + 1;
            
            if (playerRoll >= monsterRoll) {
                speak(`You defeat the ${monster}!`);
                room.monsters = [];
            } else {
                speak(`The ${monster} hits you! You lose health.`);
                player.health -= 20;
                if (player.health <= 0) {
                    speak("You died! Game over. Say warrior, mage, or rogue to restart.");
                    gameStarted = false;
                    player.health = 100;
                    currentRoom = 'entrance';
                }
            }
        }

        function search() {
            let room = rooms[currentRoom];
            if (room.items.length > 0) {
                let item = room.items.shift();
                player.inventory.push(item);
                speak(`You found a ${item}!`);
            } else {
                speak("You found nothing.");
            }
        }

        function showInventory() {
            if (player.inventory.length === 0) {
                speak("Your inventory is empty.");
            } else {
                speak(`You have: ${player.inventory.join(', ')}.`);
            }
        }

        function usePotion() {
            let potionIndex = player.inventory.indexOf('health potion');
            if (potionIndex !== -1) {
                player.inventory.splice(potionIndex, 1);
                player.health = Math.min(100, player.health + 50);
                speak(`You drink the potion. Health restored to ${player.health}.`);
            } else {
                speak("You don't have a health potion.");
            }
        }
    </script>
</body>
</html>
